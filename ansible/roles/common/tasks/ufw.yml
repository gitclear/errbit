---
- name: install | Install UFW firewall
  apt: package=ufw state=present

- name: conf | Configure ufw defaults
  ufw: direction={{ item.direction }} policy={{ item.policy }}
  with_items:
    - { direction: 'incoming', policy: 'deny' }
    - { direction: 'outgoing', policy: 'allow' }
  notify: restart ufw

- name: conf | Configure ufw settings
  ufw:
    rule: "{{ item.rule }}"
    name: "{{ item.name }}"
  with_items:
    - { rule: 'allow', name: 'OpenSSH' }
  notify: restart ufw

- name: ufw | Errbit servers allow port 80 and 443
  ufw:
    rule: allow
    port: "{{ item }}"
  with_items:
    - 80
    - 443
  when: inventory_hostname in groups['errbit']

- name: Enable ufw
  ufw: state=enabled
